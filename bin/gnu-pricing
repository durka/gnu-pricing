#!/usr/bin/env bash

#get this script's directory and command name
pushd `dirname $0` > /dev/null
THISDIR=`pwd`
popd > /dev/null

#remove the pricing directory from the path
#(that way, the only commands that can't be priced are dirname, echo, and sed)
PATH=`echo $PATH | sed "s@$THISDIR:@@"`

#get a list of commands from the usage history
mkdir -p "$HOME/.gnu-pricing/"
TOTALCOUNT="0"
USEDCMDS=`ls -1 "$HOME/.gnu-pricing/" | sed 's@.usage$@@'`

#print header
echo -e "Overall GNU command usage"
echo -e ""
echo -e " command   usage   cost"
echo -e "--------- ------- ------"

#get the usage count for each command
for cmd in $USEDCMDS
do
    #read the usage count for this command
    THISCOUNT=`cat "$HOME/.gnu-pricing/$cmd.usage"`

    #calculate the cost for this command
    USECOST=$(( $THISCOUNT * 100 / 100 ))

    #print the total usage and cost
    printf "%9s %7d $%d.%02d\n" "$cmd" $THISCOUNT $(echo "$USECOST / 100" | bc) $(echo "$USECOST % 100" | bc)

    #add the usage for this command to the total usage
    TOTALCOUNT=$(( $TOTALCOUNT + $THISCOUNT ))
done

#calculate the total cost
TOTALCOST=$(( $TOTALCOUNT * 100 / 100 ))

echo -e "--------- ------- ------"
printf "%9s %7d $%d.%02d\n" Total $TOTALCOUNT $(echo "$TOTALCOST / 100" | bc) $(echo "$TOTALCOST % 100" | bc)

